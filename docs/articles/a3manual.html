<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Genetic Management Tools Manual • nprcgenekeepr</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Genetic Management Tools Manual">
<meta property="og:description" content="nprcgenekeepr">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">nprcgenekeepr</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">1.0.5</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/ColonyManagerTutorial.html">GeneKeepR: A Colony Manager's Tutorial</a>
    </li>
    <li>
      <a href="../articles/a2interactive.html">Interactive Use of nprcgenekeepr</a>
    </li>
    <li>
      <a href="../articles/a3manual.html">Genetic Management Tools Manual</a>
    </li>
    <li>
      <a href="../articles/shiny_app_use.html">GeneKeepR Tutorial</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/rmsharp/nprcgenekeepr/">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="a3manual_files/header-attrs-2.7/header-attrs.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Genetic Management Tools Manual</h1>
                        <h4 class="author">Michael Raboin, Amanda Vinson, and R. Mark Sharp</h4>
            
            <h4 class="date">April 12, 2020</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/rmsharp/nprcgenekeepr/blob/master/vignettes/a3manual.Rmd"><code>vignettes/a3manual.Rmd</code></a></small>
      <div class="hidden name"><code>a3manual.Rmd</code></div>

    </div>

    
    
<p><a href="#introduction">Introduction</a><br><a href="#summary-of-major-functions">Summary of Major Functions</a><br><a href="#installation">Installation</a><br><a href="#running-shiny-application">Running Shiny Application</a><br><a href="#input">Input</a><br><a href="#pedigree-browser">Pedigree Browser</a><br><a href="#genetic-value-analysis">Genetic Value Analysis</a><br><a href="#summary-statistics">Summary Statistics</a><br><a href="#breeding-group-formation-1">Breeding Group Formation</a><br><a href="#orip-reporting">ORIP Reporting</a><br><a href="#algorithm-breeding-group-formation">Algorithm: Breeding Group Formation</a><br><a href="#algorithm-genome-uniqueness">Algorithm: Genome Uniqueness</a></p>
<div id="introduction" class="section level2">
<h2 class="hasAnchor">
<a href="#introduction" class="anchor"></a>Introduction</h2>
<p>The goal of <strong>nprcgenekeepr</strong> is to implement Genetic Tools for Colony Management. It was initially conceived and developed as a Shiny web application at the Oregon National Primate Research Center (ONPRC) to facilitate some of the analyses they perform regularly. It has been enhanced to have more capability as a Shiny application and to expose the functions so they can be used either interactively or in R scripts.</p>
<p>This work has been supported in part by NIH grants P51 RR13986 to the Southwest National Primate Research Center and P51 OD011092 to the Oregon National Primate Research Center.</p>
<!--It is now managed and maintained as a joint effort between ONPRC-->
<!--and Southwest National Primate Research Center (SNPRC) with the -->
<!--coding being done by R. Mark Sharp, Ph.D.-->
<p>At present, the application supports 5 functions:</p>
<ol style="list-style-type: decimal">
<li>Quality control of studbooks contained in text files or Excel workbooks and of pedigrees within LabKey Electronic Health Records (EHR)</li>
<li>Creation of pedigrees from a lists of animals using the LabKey EHR integration</li>
<li>Creation and display of an age by sex pyramid plot of the living animals within the designated pedigree</li>
<li>Generation of Genetic Value Analysis Reports</li>
<li>Creation of potential breeding groups with and without proscribed sex ratios and defined maximum kinships.</li>
</ol>
<p><strong>For more information see:</strong><br>
A Practical Approach for Designing Breeding Groups to Maximize Genetic Diversity in a Large Colony of Captive Rhesus Macaques (<em>Macaca mulatto</em>) Vinson, A ; Raboin, MJ <em>Journal Of The American Association For Laboratory Animal Science</em>, 2015 Nov, Vol.54(6), pp.700-707 [Peer Reviewed Journal]</p>
</div>
<div id="summary-of-major-functions" class="section level2">
<h2 class="hasAnchor">
<a href="#summary-of-major-functions" class="anchor"></a>Summary of Major Functions</h2>
<div id="quality-control" class="section level3">
<h3 class="hasAnchor">
<a href="#quality-control" class="anchor"></a>Quality Control</h3>
<p>Studbooks maintained by breeding colonies generally contain information of varying quality. The quality control functions of the toolkit check to ensure all animals listed as parents have their own line entries, all parents have the appropriate sex listed, no animals are listed as both a sire and a dam, duplicate entries are removed, pedigree generation numbers are added, and all dates are valid dates. In addition, exit dates are added if possible and are consistent with other information such as departure dates and death dates. Current ages of animals that are still alive are added if a database connection is provided via a configuration file and the user has read permission on a LabKey server with the demographic data in an <strong>EHR</strong> (Electronic Health Record) module. See</p>
<p>Parents with ages below a user selected threshold are identified. A minimum parent age in years is set by the user and is used to ensure each parent is at least that age on the birth date of an offspring. The minimum parent age defaults to 2 years. This check is not performed for animals with missing birth dates.</p>
</div>
<div id="creation-of-pedigree-from-a-list-of-potential-breeders-and-labkey-integration" class="section level3">
<h3 class="hasAnchor">
<a href="#creation-of-pedigree-from-a-list-of-potential-breeders-and-labkey-integration" class="anchor"></a>Creation of Pedigree From a List of Potential Breeders and LabKey Integration</h3>
<p>The user can enter a list of focal animals in a CSV file that will be used to create a pedigree containing all direct relative (ancestors and descendants) via the <strong>labkey.selectRows</strong> function within the <strong>Rlabkey</strong> package if a database connection is provided via a configuration file and the user has read permission on a LabKey server with the demographic data in an <strong>EHR</strong> (Electronic Health Record) module.</p>
<p>Two configuration files are needed to use the database features of nprcgenekeepr with LabKey. The first file is named <strong>_netrc</strong> on Microsoft Windows operating systems and <strong>.netrc</strong> otherwise, allows the user to authenticate with LabKey through the LabKey API and is fully described by <a href="https://www.labkey.org/Documentation/wiki-page.view?name=netrc">LabKey documentation</a></p>
<p>The second file is named <strong>_nprcgenekeepr_config</strong> on Microsoft Windows operating systems and <strong>.nprcgenekeepr_config</strong> otherwise and is the <code>nprcgenekeepr</code> <a href="https://github.com/rmsharp/nprcgenekeepr/blob/master/inst/extdata/example_nprcgenekeepr_config">configuration file</a> An image of this example configuration file is included as a data object and can be loaded and viewed with the following lines of R code in the R console.</p>
</div>
<div id="display-of-an-age-by-sex-pyramid-plot" class="section level3">
<h3 class="hasAnchor">
<a href="#display-of-an-age-by-sex-pyramid-plot" class="anchor"></a>Display of an age by sex pyramid plot</h3>
<p>Adapted from  on 20190603. Written by Matt Rosenberg. Updated May 07, 2019</p>
<p>The most important demographic characteristic of a population is its age-sex structure. Age-sex pyramids (also known as population pyramids) graphically display this information to improve understanding and make comparison easy. The population pyramid sometimes has a distinctive pyramid-like shape when displaying a growing population.</p>
<div id="how-to-read-the-age-sex-graph" class="section level4">
<h4 class="hasAnchor">
<a href="#how-to-read-the-age-sex-graph" class="anchor"></a>How to Read the Age-Sex Graph</h4>
<p>An age-sex pyramid breaks down a population into male and female genders and age ranges. Usually, you’ll find the left side of the pyramid graphing the male population and the right side of the pyramid displaying the female population.</p>
<p>Along the horizontal axis (x-axis) of a population pyramid, the graph displays the population either as a total population of that age or as a percentage of the population at that age. The center of the pyramid starts at zero population and extends out to the left for males and right for females in increasing size, or proportion of the population.</p>
<p>Along the vertical axis (y-axis), age-sex pyramids display two-year age increments, from birth at the bottom to old age at the top.</p>
</div>
</div>
<div id="genetic-value-analysis-reports" class="section level3">
<h3 class="hasAnchor">
<a href="#genetic-value-analysis-reports" class="anchor"></a>Genetic Value Analysis Reports</h3>
<p>The Genetic Value Analysis is a ranking scheme developed at ONPRC to indicate the relative breeding value of animals in the colony. The scheme uses the mean kinship for each animal to indicate how inter-related it is with the rest of the current breeding colony members. Genome uniqueness is used to provide an indication of whether or not an animal is likely to possess alleles at risk of being lost from the colony. Under the scheme, animals with low mean kinship or high genome uniqueness are ranked more highly.</p>
</div>
<div id="breeding-group-formation" class="section level3">
<h3 class="hasAnchor">
<a href="#breeding-group-formation" class="anchor"></a>Breeding Group Formation</h3>
<p>One of the goals in breeding group formation is to avoid the potential for mating of closely related animals. Since behavioral concerns and housing constraints will also be taken into account in the group formation process, it is our goal to provide the largest number of animals possible from a list of candidates that can be housed together without risk of consanguineous mating. To that end, this function uses information from the Genetic Value Analysis to search for the largest combinations of animals that can be produced from a list of candidates.</p>
<p>The default options do not consider the sex of individuals when forming the groups, though this has likely been a consideration by the user in selecting the candidate group members. Optionally the user may select to form harem groups, which considers the sex of individuals when forming groups and restricts the number of males to one per group.</p>
</div>
</div>
<div id="installation" class="section level2">
<h2 class="hasAnchor">
<a href="#installation" class="anchor"></a>Installation</h2>
<p>You can install the development version of <strong>nprcgenekeepr</strong> from GitHub from the R console prompt with:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html">install.packages</a></span><span class="op">(</span><span class="st">"devtools"</span><span class="op">)</span>
<span class="fu">devtools</span><span class="fu">::</span><span class="fu"><a href="https://devtools.r-lib.org//reference/remote-reexports.html">install_github</a></span><span class="op">(</span><span class="st">"rmsharp/nprcgenekeepr"</span><span class="op">)</span></code></pre></div>
<p>All missing dependencies should be automatically installed.</p>
</div>
<div id="running-shiny-application" class="section level2">
<h2 class="hasAnchor">
<a href="#running-shiny-application" class="anchor"></a>Running Shiny Application</h2>
<p>The toolset available within nprcgenekeepr can be used inside standard R scripts. However, it was originally designed to be used within a Shiny application that can be started with:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://rmsharp.github.io/nprcgenekeepr/">nprcgenekeepr</a></span><span class="op">)</span>
<span class="fu"><a href="../reference/runGeneKeepR.html">runGeneKeepR</a></span><span class="op">(</span><span class="op">)</span></code></pre></div>
</div>
<div id="input" class="section level2">
<h2 class="hasAnchor">
<a href="#input" class="anchor"></a>Input</h2>
<p>The Input tab is the starting point for all analyses. The file should be a delimited, regular text file with a header row specifying the columns. The tab provides information on the allowable columns in input files, and how the columns will be used in quality control of the data. Quality control of studbook data occurs automatically upon file upload.</p>
<p>Presently, the only columns required are those specifying the Ego ID, Sire ID, Dam ID, and Sex. The remaining columns listed are optional, but will be used if they are present in the uploaded file. The table of the tab describes how these optional columns will be used. Additionally, the panel on the left of this tab provides options that can be used during the upload and QC process, such as specifying the field separator used in the uploaded file.</p>
<p>During quality control, a flag is added for the current, living population. This flag is generated based on the information columns provided and is fairly specific to how the breeding population is defined at ONPRC. Two of the options for specifying the population of interest can be toggled through this panel, however. Normally, the breeding colony is restricted to Indian-origin, SPF 4 animals. These two restrictions can be turned off by setting the options on this panel.</p>
<p>Additionally, the population of interest can be specified directly in either the input file, or entered on the Pedigree Browser tab.</p>
</div>
<div id="pedigree-browser" class="section level2">
<h2 class="hasAnchor">
<a href="#pedigree-browser" class="anchor"></a>Pedigree Browser</h2>
<p>The Pedigree Browser tab allows the user to view the input data, specify a population to examine, and output the cleaned studbook or trimmed pedigree.</p>
<p>Upon uploading a studbook file, the data goes through the quality control process described on the Input File Format tab. The cleaned version is displayed on this tab. By default, the entire uploaded studbook will be available for viewing on this tab. The first 10 rows will automatically be shown, but this range can be adjusted using the input boxes at the top. The default setting of showing only the first 10 rows is due to the size of the full ONPRC studbook: loading all 32,000 animals can cause the application to be slow.</p>
<p>The tab also contains functionality for trimming the pedigree. By checking the provided box, the studbook that was uploaded will be trimmed down to just the ancestors of the currently specified population. This will remove any lineages that haven’t contributed to the focal group.</p>
<p>As stated above, this tab will also allow the user to directly specify a population to examine. In the top half of the tab, there is an input box to specify the focal set of animals. The population flag can be reset by adding the desired animal IDs to the box. Once the population flag has been set to the desired group of animals, all further analyses will be relative to this group.</p>
</div>
<div id="genetic-value-analysis" class="section level2">
<h2 class="hasAnchor">
<a href="#genetic-value-analysis" class="anchor"></a>Genetic Value Analysis</h2>
<p>The Genetic Value Analysis tab provides all of the options needed for producing a genetic value analysis report. The specifics of generating the genetic value analysis report are described on the <strong><em>Genetic Value Analysis and Breeding Group Description</em></strong> tab.</p>
<p>When the analysis is begun, it will generate a genetic value analysis for the currently-specified population in the pedigree. If no population has been specified, the entire pedigree will go into the analysis. This can be problematic, as the function for calculating the pairwise kinship matrix cannot handle large pedigrees. The kinship calculation is known to handle pedigree files containing up to 6000 individuals. It will not, however, handle the whole ONPRC rhesus studbook (~24,000 animals). The exact maximum pedigree size is not currently known and will need to be tested. Due to these problems, the input studbook will automatically be trimmed to the ancestors of the currently-specified population before the genetic value analysis is begun.</p>
<p>The genome uniqueness threshold input box allows the user to specify what constitutes a ‘unique’ allele in the gene-drop simulation. The algorithm description later in this document provides a more in-depth explanation of how the genome uniqueness calculation uses this information. By default, the gene-drop simulation underlying the genome uniqueness calculation considers an individual as unique if no other members of the current population have inherited the same allele during an iteration of the gene-drop. This can be adjusted using the drop-down box to allow up to four other animals to have inherited the allele and still consider it unique.</p>
<p>After the report has been generated, it can be subset to view a specific group of the animals using the text input box. Both the currently-viewed subset and the full report can be exported to a file from here.</p>
</div>
<div id="summary-statistics" class="section level2">
<h2 class="hasAnchor">
<a href="#summary-statistics" class="anchor"></a>Summary Statistics</h2>
<p>This tab provides some descriptions of the population being examined after the genetic value analysis has been run. The tab reports the number of known founders, female founders, male founders, founder equivalents, and founder genome equivalents with the first table, which has a single row. The second table has a row for Mean Kinship and a row for Genome Uniqueness. Each row has the Tukey five number summary, which is the minimum, 1<sup>st</sup> quartile, mean, median, 3<sup>rd</sup> quartile, and maximum. Lastly, the tab displays histograms and box plots of the distribution of mean kinship coefficients, the distribution of mean kinship coefficient Z-scores, Distribution of genome uniqueness values.</p>
</div>
<div id="breeding-group-formation-1" class="section level2">
<h2 class="hasAnchor">
<a href="#breeding-group-formation-1" class="anchor"></a>Breeding Group Formation</h2>
<p>The last major function of the R-package is to aid in generating breeding groups that avoid inter-animal relatedness. This tab allows you to build a number of breeding groups from a specified list of candidate animals. It also has an option to build a group by adding animals from a list of candidates to a currently-existing group.</p>
<p>In the top half of the tab, there are entry boxes and menus to adjust the options of the analysis. By default, the analysis will ignore relatedness between animals that is more distant than the second cousin level, pairwise relatedness involving an animal under 1 year of age, and relatedness between all females. All of these options can be adjusted before the analysis is run, however.</p>
<p>If the desire is to add animals to an existing group, the IDs of the candidate animals can be entered into the first text box (just as they would be if a new group were being generated). The IDs of the current group members can be added into the second text box. It should be noted that it will cause an error if the provided candidate animals or current group member IDs are not part of the population for which a genetic value analysis was run. The kinship matrix produced for this analysis provides the pairwise kinship values used by the group formation functions.</p>
<p>After the simulation is done, the first group will be displayed automatically. The group being displayed can be changed with the drop-down menu. Whichever group is currently being displayed can then be downloaded with the export button.</p>
</div>
<div id="genetic-value-analysis-and-breeding-group-formation-description" class="section level2">
<h2 class="hasAnchor">
<a href="#genetic-value-analysis-and-breeding-group-formation-description" class="anchor"></a>Genetic Value Analysis and Breeding Group Formation Description</h2>
<p>This tab contains more in-depth descriptions of how the Genetic Value Analysis is created, and how breeding groups are formed by the program.</p>
</div>
<div id="orip-reporting" class="section level2">
<h2 class="hasAnchor">
<a href="#orip-reporting" class="anchor"></a>ORIP Reporting</h2>
<p>The ORIP Reporting tab will eventually contain information for reporting to the Office of Research Infrastructure Programs (ORIP). This tab may end up being merged with the Summary Statistics tab and contain a number of statistics, tables and histograms. Alternatively, this may contain a subset of information from the Summary Statistics tab presented as a formatted report that can be exported and submitted to ORIP. The exact information that needs to be submitted for ORIP recordkeeping is still under discussion.</p>
</div>
<div id="algorithm-breeding-group-formation" class="section level2">
<h2 class="hasAnchor">
<a href="#algorithm-breeding-group-formation" class="anchor"></a>Algorithm: Breeding Group Formation</h2>
<p>The group formation process is accomplished by using an algorithm for determining the maximal independent set (MIS). In graph theory, a maximal independent set is the largest set of vertices in a graph where no two share an edge. In breeding group formation, the vertices are animals, and the edges are the kinships that need to be considered. For a given group of animals and pairwise kinships, there are potentially many maximal independent sets, depending on which animals are included or excluded from the final group. In order to effectively sample the set of MISs, we use random selection of animals and repeat the MIS generation numerous times. This allows us to sample a number of MISs and then choose the one that best fits our selection criteria. For our purposes, we want the largest group that can be formed from this set of animals, where none have concerning relatedness to each other.</p>
<p>The algorithm requires several pieces of information:</p>
<ol style="list-style-type: decimal">
<li>The candidate animals<br>
</li>
<li>A matrix of pairwise kinships between candidate animals<br>
</li>
<li>The number of groups desired from the list of candidate animals<br>
</li>
<li>The number of simulations to run.<br>
* This is equivalent to the number of random MISs to generate and compare.<br>
</li>
<li>Information on which inter-animal relationships (if any) should be ignored.</li>
</ol>
<div id="data-pre-processing" class="section level4">
<h4 class="hasAnchor">
<a href="#data-pre-processing" class="anchor"></a>Data Pre-processing</h4>
<p>Before the group formation algorithm begins generating MISs, the data is pre-processed to remove any animals and pairwise kinships that should not be considered.</p>
<p>Specifically:</p>
<ol style="list-style-type: decimal">
<li>The candidate animals provided are checked, and any that were designated as low-value by the genetic value analysis will be removed from further consideration.<br>
* This behavior can be toggled off to allow low-value animals in the formation process<br>
</li>
<li>The pairwise kinship data is filtered down to only the kinship between candidate animals.<br>
</li>
<li>If an age threshold has been set, kinships involving animals below the threshold will be filtered out.<br>
* This allows the algorithm to ignore young animals, as young animals typically go to whatever social group their dam does.<br>
* By default, we ignore animals under 1 year of age<br>
</li>
<li>Pairwise kinships below the specified level will be filtered out.<br>
* By default, we ignore relatedness more distant than 2nd cousin<br>
</li>
<li>Pairwise kinships between females will be filtered out<br>
* This allows females of the same matriline to be part of the same group like they would be in the wild.<br>
* This behavior can be toggled off to prevent relatedness between females.</li>
</ol>
</div>
<div id="random-maximum-independent-set-generation" class="section level4">
<h4 class="hasAnchor">
<a href="#random-maximum-independent-set-generation" class="anchor"></a>Random Maximum Independent Set Generation</h4>
<p>After any animals and relationships that should be ignored are removed from the dataset, the algorithm begins using the remaining animals and kinship information to generate potential groups.</p>
<p>The algorithm proceeds by the following steps:</p>
<ol style="list-style-type: decimal">
<li>For <strong>I</strong> iterations:
<ol style="list-style-type: lower-alpha">
<li>Generate <strong>N</strong> empty sets, where <strong>N</strong> is the desired number of groups to be created.<br>
</li>
<li>While there are candidate animals remaining:<br>
i. Pick an animal <strong>A</strong> randomly from the set of candidate animals<br>
ii. Choose a group <strong>G</strong> randomly from one of the <strong>N</strong> groups, and assign <strong>A</strong> to it<br>
iii. Remove animal <strong>A</strong> from consideration for all <strong>N</strong> groups<br>
iv. Remove all animals related to <strong>A</strong> from consideration from for group <strong>G</strong><br>
</li>
<li>Score the groups that were generated<br>
i. For our purposes, we calculate the average group size<br>
</li>
<li>If the score of the new groups is higher than groups that were previously generated, save the new groups.<br>
</li>
</ol>
</li>
<li>Return the currently saved groups
<ol style="list-style-type: lower-alpha">
<li>This should be the best groups encountered in <strong>I</strong> iterations.</li>
</ol>
</li>
</ol>
</div>
</div>
<div id="algorithm-genome-uniqueness" class="section level2">
<h2 class="hasAnchor">
<a href="#algorithm-genome-uniqueness" class="anchor"></a>Algorithm: Genome Uniqueness</h2>
<p>Genome uniqueness is calculated through the use of a gene-drop simulation to estimate how frequently an animal will possess founder alleles not present in other members of the focal population, or present in a specified number or fewer.</p>
<p>The gene-drop simulation used by the web application is a vectorized version and is shown in the figure below. In an un-vectorized version, if 5000 gene-drop simulations are desired for the estimation process, the population had to be iterated over 5000 times. Since each iteration of the gene-drop is independent, the process can be vectorized so that each element of a vector represents 1 iteration of the gene-drop simulation. In the vectorized version, the population is iterated over once, regardless of the number of simulations desired. This drastically reduces the amount of time necessary for the program to run.</p>
<div id="overview" class="section level4">
<h4 class="hasAnchor">
<a href="#overview" class="anchor"></a>Overview</h4>
<p>The basic steps of the gene-drop are:</p>
<ol style="list-style-type: decimal">
<li>Each founder is assigned two unique alleles<br>
</li>
<li>For each subsequent generation:
<ol style="list-style-type: lower-alpha">
<li>Assign genotypes to each member of the generation
<ul>
<li>For each animal, find the genotypes of the parents, and select<br>
one allele from each parent randomly.</li>
</ul>
</li>
</ol>
</li>
</ol>
<p>Once every animal has been assigned a genotype by mendelian inheritance tally the number of unique alleles possessed by each member of the focal population. In the case of this algorithm, we do allow the ‘uniqueness’ threshold to be adjusted so that an allele can be considered unique if it is possessed by N or fewer other members of the focal population.</p>
</div>
<div id="vectorized-gene-drop-details" class="section level4">
<h4 class="hasAnchor">
<a href="#vectorized-gene-drop-details" class="anchor"></a>Vectorized Gene-Drop Details</h4>
<p>The vectorized gene-drop simulation follows the same basic process described above. The difference is that instead of dropping one allele at a time, and repeating the simulation N times, the vectorized version drops N independent alleles one time.</p>
<p>In the vectorized version, each animal has a vector of paternally inherited alleles and a vector of maternally inherited alleles. For each offspring, a random combination of these alleles is produced and dropped down to the offspring by the process below and shown in the following figure:</p>
<ol style="list-style-type: decimal">
<li>To start the simulation, each founder is assigned two unique founding alleles.<br>
N-element vectors are created of these alleles, where N is the desired number of<br>
simulations. In the example below, this founder was assigned the unique founder<br>
alleles 1 &amp; 2 and 5 simulations were desired.<br>
</li>
<li>Each time alleles need to be dropped from parent to offspring, a unique<br>
transmission vector is created representing whether or not an allele<br>
was passed to that offspring. The vector is generated to contain a random combination<br>
of 0’s and 1’s. The animal’s paternally inherited alleles are then multiplied by the<br>
transmission vector, while the maternally inherited alleles are multiplied by the<br>
compliment of the transmission vector.<br>
</li>
<li>To generate the final set of alleles received by the offspring, the maternal and<br>
paternal allele vectors are added together.<br>
</li>
<li>The result is a vector of alleles that this offspring has received from this parent.</li>
</ol>
<p>Once allele vectors have been generated for every animal in the pedigree, the focal population can be subset out. Within this population of allele vectors, unique alleles can be determined:</p>
<p>For each position on the allele vectors (1:N) - Gather each animal’s two alleles - If the number of other animals possessing that allele is equal to, or below the threshold, score the allele as unique (1) - Otherwise, score the allele as non-unique (0)</p>
<p>Once every position on each animal’s two allele vector’s has been scored, sum all of the scores for an animal and divide by the total number of alleles being considered (2 * number of simulations).</p>
<div class="figure">
<img src="../inst/application/www/GeneDrop.png" alt=""><p class="caption">Generation of a vector of five gametes from one parent. Showing how the transmission vectors (row 2) determine which alleles are passed from the parental alleles or haplotypes (row 1) to form complementary vectors (row 3) that are combined by adding corresponding elements to form the final vector of transmitted alleles (row 4).</p>
</div>
</div>
</div>
<div id="software-issues" class="section level2">
<h2 class="hasAnchor">
<a href="#software-issues" class="anchor"></a>Software Issues</h2>
<p>Our goal is to use current R software development practices in an open software environment. Users can see all of the code at <a href="https://github.com/rmsharp/nprcgenekeepr">github.com/rmsharp/nprcgenekeepr</a> and can submit suggestions and bug reports on our issue tracker at <a href="https://github.com/rmsharp/nprcgenekeepr/issues">github.com/rmsharp/nprcgenekeepr/issues</a>.</p>
<div id="travis-ci-use" class="section level3">
<h3 class="hasAnchor">
<a href="#travis-ci-use" class="anchor"></a>Travis-ci Use</h3>
<p>The application and associated website is being continuously integrated at each push to the online repository. While often new features being added are not stable or complete, it is uncommon for the application not to run and perform functions that were working before. However, make sure the build was passing by looking for a green <em>Build Passing</em> badge at the top of the README file at <a href="https://travis-ci.org/rmsharp/nprcgenekeepr">travis-ci.org/rmsharp/nprcgenekeepr</a>.</p>
</div>
<div id="debug-logging" class="section level3">
<h3 class="hasAnchor">
<a href="#debug-logging" class="anchor"></a>Debug Logging</h3>
<p>There is a logging system integrated into the package using the package <strong>futile.logger</strong>. Note the checkbox at the bottom of the side panel on the <em>Input</em> tab. When the <em>Debug on</em> checkbox is checked (it is not checked by default), the application writes to a file named <em>nprcgenekeepr.log</em> in the users home directory. Currently, events occurring the the <em>server.R</em> file are logged as that is where most errors are exposed.</p>
</div>
<div id="code-coverage" class="section level3">
<h3 class="hasAnchor">
<a href="#code-coverage" class="anchor"></a>Code Coverage</h3>
<p>Code coverage reports are part of the automated build system running on Travis-CI.org. We are using the <strong>testthat</strong> package for unit tests. Currently all code returning values that do not access a database or the file system have coverage with unit tests. Many of these have 100 percent of the lines covered. However, the unit tests are not exhaustive. The practice is to add further tests as errors are detected or when working on the code and a new unit test possibility is discovered. As of 20190701 94.31 percent of the lines are covered.</p>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by Michael Raboin, Terry Therneau, Amanda Vinson, R. Mark Sharp, Southwest National Primate Research Center NIH grant P51 RR13986, Oregon National Primate Research Center grant P51 OD011092.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
