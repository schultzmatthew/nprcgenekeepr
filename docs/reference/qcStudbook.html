<!-- Generated by pkgdown: do not edit by hand -->
<!DOCTYPE html>
<html lang="en">
  <head>
  <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>Quality Control for the Studbook or pedigree — qcStudbook • nprcgenekeepr</title>


<!-- jquery -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script>
<!-- Bootstrap -->

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous" />

<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script>

<!-- bootstrap-toc -->
<link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script>

<!-- Font Awesome icons -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous" />

<!-- clipboard.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script>

<!-- headroom.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script>

<!-- pkgdown -->
<link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script>




<meta property="og:title" content="Quality Control for the Studbook or pedigree — qcStudbook" />
<meta property="og:description" content="Main pedigree curation function that performs basic quality control on
pedigree information" />




<!-- mathjax -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script>

<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->



  </head>

  <body data-spy="scroll" data-target="#toc">
    <div class="container template-reference-topic">
      <header>
      <div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">nprcgenekeepr</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">1.0.5</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="../index.html">
    <span class="fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="../articles/ColonyManagerTutorial.html">GeneKeepR: A Colony Manager's Tutorial</a>
    </li>
    <li>
      <a href="../articles/a2interactive.html">Interactive Use of nprcgenekeepr</a>
    </li>
    <li>
      <a href="../articles/a3manual.html">Genetic Management Tools Manual</a>
    </li>
    <li>
      <a href="../articles/shiny_app_use.html">GeneKeepR Tutorial</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="https://github.com/rmsharp/nprcgenekeepr/">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
      
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header>

<div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Quality Control for the Studbook or pedigree</h1>
    <small class="dont-index">Source: <a href='https://github.com/rmsharp/nprcgenekeepr/blob/master/R/qcStudbook.R'><code>R/qcStudbook.R</code></a></small>
    <div class="hidden name"><code>qcStudbook.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>Main pedigree curation function that performs basic quality control on
pedigree information</p>
    </div>

    <pre class="usage"><span class='fu'>qcStudbook</span><span class='op'>(</span><span class='va'>sb</span>, minParentAge <span class='op'>=</span> <span class='fl'>2</span>, reportChanges <span class='op'>=</span> <span class='cn'>FALSE</span>, reportErrors <span class='op'>=</span> <span class='cn'>FALSE</span><span class='op'>)</span></pre>

    <h2 class="hasAnchor" id="arguments"><a class="anchor" href="#arguments"></a>Arguments</h2>
    <table class="ref-arguments">
    <colgroup><col class="name" /><col class="desc" /></colgroup>
    <tr>
      <th>sb</th>
      <td><p>A dataframe containing a table of pedigree and demographic
information.</p>
<p>The function recognizes the following columns (optional columns
will be used if present, but are not required):</p>
<ul>
<li><p>id --- Character vector with Unique identifier for all individuals</p></li>
<li><p>sire --- Character vector with unique identifier for the father of
the current id</p></li>
<li><p>dam --- Character vector with unique identifier for the mother of
the current id</p></li>
<li><p>sex --- Factor levels: "M", "F", "U" Sex specifier for an
individual</p></li>
<li><p>birth --- Date or <code>NA</code> (optional) with the individual's birth
date</p></li>
<li><p>departure --- Date or <code>NA</code> (optional) an individual was sold
or shipped from the colony</p></li>
<li><p>death --- date or <code>NA</code> (optional)
 Date of death, if applicable</p></li>
<li><p>status --- Factor levels: ALIVE, DEAD, SHIPPED (optional)
 Status of an individual</p></li>
<li><p>origin --- Character or <code>NA</code> (optional)
 Facility an individual originated from, if other than ONPRC</p></li>
<li><p>ancestry --- Character or <code>NA</code> (optional)
 Geographic population to which the individual belongs</p></li>
<li><p>spf --- Character or <code>NA</code> (optional)
 Specific pathogen-free status of an individual</p></li>
<li><p>vasxOvx --- Character or <code>NA</code> (optional)
 Indicator of the vasectomy/ovariectomy status of an animal; <code>NA</code> if
 animal is intact, assume all other values indicate surgical alteration</p></li>
<li><p>condition --- Character or <code>NA</code> (optional)
 Indicator of the restricted status of an animal. "Nonrestricted" animals
 are generally assumed to be naive.</p></li>
</ul></td>
    </tr>
    <tr>
      <th>minParentAge</th>
      <td><p>numeric values to set the minimum age in years for
an animal to have an offspring. Defaults to 2 years. The check is not
performed for animals with missing birth dates.</p></td>
    </tr>
    <tr>
      <th>reportChanges</th>
      <td><p>logical value that if <code>TRUE</code>, the <code>errorLst</code>
contains the list of changes made to the column names. Default is
<code>FALSE</code>.</p></td>
    </tr>
    <tr>
      <th>reportErrors</th>
      <td><p>logical value if <code>TRUE</code> will scan the entire file
and report back changes made to input and errors in a
list of list where each sublist is a type of change or error found.
Changes will include column names, case of categorical values (male,
female, unknown), etc.
Errors will include missing columns, invalid date rows, male dams,
female sires, and records with one or more parents  below minimum age
of parents.</p>
<p>The following changes are made to the cols.</p>
<ul>
<li><p>Column cols are converted to all lower case</p></li>
<li><p>Periods (".") within column cols are collapsed to no space ""</p></li>
<li><p><code>egoid</code> is converted to <code>id</code></p></li>
<li><p><code>sireid</code> is convert to <code>sire</code></p></li>
<li><p><code>damid</code> is converted to <code>dam</code></p></li>
</ul>

<p>If the dataframe (<code>sb</code> does not contain the five required columns
(<code>id</code>, <code>sire</code>, <code>dam</code>, <code>sex</code>), and
<code>birth</code> the function throws an error by calling <code><a href='https://rdrr.io/r/base/stop.html'>stop()</a></code>.</p>
<p>If the <code>id</code> field has the string <em>UNKNOWN</em> (any case) or both
the fields <code>sire</code> or <code>dam</code> have <code>NA</code> or <em>UNKNOWN</em>
(any case), the record is removed.
If either of the fields <code>sire</code> or <code>dam</code> have the
string <em>UNKNOWN</em> (any case), they are replaced with a unique identifier
with the form <code>Unnnn</code>, where <code>nnnn</code> represents one of a series
of sequential integers representing the number of missing sires and
dams right justified in a pattern of <code>0000</code>. See <code>addUIds</code>
function.</p>
<p>The function <code>addParents</code> is used to add records for parents missing
their own record in the pedigree.</p>
<p>The function <code>convertSexCodes</code> is used with <code>ignoreHerm == TRUE</code>
to convert sex codes according to the following factors of standardized
codes:</p>
<ul>
<li><p>F -- replacing "FEMALE" or "2"</p></li>
<li><p>M -- replacing "MALE" or "1"</p></li>
<li><p>H -- replacing "HERMAPHRODITE" or "4", if ignore.herm == FALSE</p></li>
<li><p>U -- replacing "HERMAPHRODITE" or "4", if ignore.herm == TRUE</p></li>
<li><p>U -- replacing "UNKNOWN" or "3"</p></li>
</ul>

<p>The function <code>correctParentSex</code> is used to ensure no parent is both
a sire and a dam. If this error is detected, the function throws an error
and halts the program.</p>
<p>The function <code>convertStatusCodes</code> converts status indicators to the
following factors of standardized codes. Case of the original status value
is ignored.</p>
<ul>
<li><p>"ALIVE" --- replacing "alive", "A" and "1"</p></li>
<li><p>"DECEASED" --- replacing "deceased", "DEAD", "D", "2"</p></li>
<li><p>"SHIPPED" --- replacing "shipped", "sold", "sale", "s", "3"</p></li>
<li><p>"UNKNOWN" --- replacing is.na(status)</p></li>
<li><p>"UNKNOWN" --- replacing "unknown", "U", "4"</p></li>
</ul>

<p>The function <code>convertAncestry</code> coverts ancestry indicators using
regular expressions such that the following conversions are made from
character strings that match selected substrings to the following factors.</p>
<ul>
<li><p>"INDIAN" --- replacing "ind" and not "chin"</p></li>
<li><p>"CHINESE" --- replacing "chin" and not "ind"</p></li>
<li><p>"HYBRID" --- replacing "hyb" or "chin" and "ind"</p></li>
<li><p>"JAPANESE" --- replacing "jap"</p></li>
<li><p>"UNKNOWN" --- replacing <code>NA</code></p></li>
<li><p>"OTHER" --- replacing not matching any of the above</p></li>
</ul>

<p>The function <code>convertDate</code> converts character representations of
dates in the columns <code>birth</code>, <code>death</code>, <code>departure</code>, and
<code>exit</code> to dates using the <code>as.Date</code> function.</p>
<p>The function <code>setExit</code> uses heuristics and the columns <code>death</code>
and <code>departure</code> to set <code>exit</code> if it is not already defined.</p>
<p>The function <code>calcAge</code> uses the <code>birth</code> and the <code>exit</code>
columns to define the <code>age</code> column. The numerical values is rounded
to the nearest 0.1 of a year. If <code>exit</code> is not defined, the
current system date (<code><a href='https://rdrr.io/r/base/Sys.time.html'>Sys.Date()</a></code>) is used.</p>
<p>The function <code>findGeneration</code> is used to define the generation number
for each animal in the pedigree.</p>
<p>The function <code>removeDuplicates</code> checks for any duplicated records and
removes the duplicates. I also throws an error and stops the program if an
ID appears in more
than one record where one or more of the other columns have a difference.</p>
<p>Columns that cannot be used subsequently are removed and the rows are
ordered by generation number and then ID.</p>
<p>Finally the columns <code>id</code> <code>sire</code>, and <code>dam</code> are coerce to
character.</p></td>
    </tr>
    </table>

    <h2 class="hasAnchor" id="value"><a class="anchor" href="#value"></a>Value</h2>

    <p>A data.frame with standardized and quality controlled pedigree
information.</p>

    <h2 class="hasAnchor" id="examples"><a class="anchor" href="#examples"></a>Examples</h2>
    <pre class="examples"><div class='input'><span class='co'># \donttest{</span>
<span class='va'>examplePedigree</span> <span class='op'>&lt;-</span> <span class='fu'>nprcgenekeepr</span><span class='fu'>::</span><span class='va'><a href='examplePedigree.html'>examplePedigree</a></span>
<span class='va'>ped</span> <span class='op'>&lt;-</span> <span class='fu'>qcStudbook</span><span class='op'>(</span><span class='va'>examplePedigree</span>, minParentAge <span class='op'>=</span> <span class='fl'>2</span>, reportChanges <span class='op'>=</span> <span class='cn'>FALSE</span>,
                  reportErrors <span class='op'>=</span> <span class='cn'>FALSE</span><span class='op'>)</span>
<span class='fu'><a href='https://rdrr.io/r/base/names.html'>names</a></span><span class='op'>(</span><span class='va'>ped</span><span class='op'>)</span>
</div><div class='output co'>#&gt;  [1] "id"           "sire"         "dam"          "sex"          "gen"         
#&gt;  [6] "birth"        "exit"         "age"          "ancestry"     "origin"      
#&gt; [11] "status"       "recordStatus"</div><div class='input'><span class='co'># }</span>

</div></pre>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top">
      <h2 data-toc-skip>Contents</h2>
    </nav>
  </div>
</div>


      <footer>
      <div class="copyright">
  <p>Developed by Michael Raboin, Terry Therneau, Amanda Vinson, R. Mark Sharp, Southwest National Primate Research Center NIH grant P51 RR13986, Oregon National Primate Research Center grant P51 OD011092.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
   </div>

  


  </body>
</html>


